<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DinoFiles ‚Ä¢ Smart Scan A4 (Beta v2)</title>
<meta name="description" content="DinoFiles ‚Äî dopasuj zdjƒôcia jak skan A4, scal PDF, zmie≈Ñ kolejno≈õƒá, podejrzyj miniatury.">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Crect width='48' height='48' rx='8' fill='%230d1a27'/%3E%3Cpath d='M14 30c-2 0-3-2-3-4 0-3 2-6 5-6l5-1c1 0 1-1 1-1l0-2c0-1 1-2 2-2h3c1 0 2 1 2 2l1 5c0 2-1 3-2 3l-6 2c0 0-1 1-1 2 0 1 1 2 2 2h9c2 0 4-1 5-3l3-6c1-2 0-4-2-5l-4-2-1-5c-1-2-3-4-5-4H22c-2 0-3 1-4 2l-4 4c-1 1-2 3-2 4v6c0 2 1 3 3 3h2' fill='%2300b050'/%3E%3C/svg%3E">
<style>
:root{--bg:#0b1520;--panel:#0f1c2a;--muted:#9fb3c8;--text:#e7f0f8;--accent:#27d07d;--line:#1e2a3a;--pill:#0b1824}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:linear-gradient(180deg,#0b1520,#0d1a27);color:var(--text)}
.wrapper{max-width:1100px;margin:24px auto;padding:0 16px}
.header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.logo{width:34px;height:34px;border-radius:8px;background:#0d1a27;display:grid;place-items:center;border:1px solid var(--line)}
.logo::before{content:'ü¶ñ';filter:saturate(1.3)}
h1{margin:0;font-size:22px;font-weight:800;letter-spacing:.2px}
.badge{font-size:12px;background:#113024;border:1px solid #1b633f;color:#9fe9c4;padding:2px 8px;border-radius:999px;margin-left:6px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.sub{color:var(--muted);margin:.25rem 0 0 0}
.drop{border:2px dashed #2b3a4f;border-radius:14px;padding:26px;text-align:center;background:rgba(255,255,255,.02);color:#cfe2f7}
.drop.drag{border-color:#5dc9ff;background:rgba(2,164,255,.08)}
.btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
.btn{background:#152335;border:1px solid var(--line);color:#dff1ff;padding:10px 14px;border-radius:12px;cursor:pointer}
.btn:hover{background:#1b2f4a}
.btn.primary{background:linear-gradient(90deg,#16c273,#2fe096);color:#082312;border-color:#2e865b;font-weight:700}
.small{font-size:13px}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
a.link{color:#7feec3}
/* Thumbs grid */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-top:12px}
.item{background:var(--pill);border:1px solid #123040;border-radius:12px;padding:8px;position:relative}
.thumb{width:100%;height:200px;background:#0a1320;border-radius:8px;display:grid;place-items:center;overflow:hidden}
.thumb canvas,.thumb img{max-width:100%;max-height:100%;display:block}
.caption{margin-top:6px;font-size:12px;color:#cfe9da;word-break:break-all}
.handle{position:absolute;inset:auto 8px 8px auto;background:#1a2a3a;color:#cfe9da;border:1px solid #2a415a;border-radius:8px;padding:4px 8px;font-size:12px;cursor:grab}
.actions{display:flex;gap:6px;position:absolute;top:8px;right:8px}
.iconbtn{background:#16273a;border:1px solid #29425c;border-radius:8px;padding:6px;cursor:pointer}
.iconbtn:hover{background:#1d3350}
/* Drag indicator */
.item.dragging{opacity:.6;outline:2px dashed #5dc9ff}
/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
.modal.open{display:flex}
.modal-body{background:#0f1c2a;border:1px solid #2a3d57;border-radius:12px;max-width:95vw;max-height:90vh;padding:12px;position:relative}
.modal-body img,.modal-body canvas{max-width:90vw;max-height:80vh}
.close{position:absolute;top:8px;right:8px;background:#16273a;border:1px solid #29425c;color:#dff1ff;border-radius:8px;padding:6px 10px;cursor:pointer}
.footer{color:#9bb8cd;margin:16px 0 40px}
</style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div class="logo"></div>
    <div>
      <h1>DinoFiles <span class="badge">BETA</span></h1>
      <p class="sub">Po≈ÇƒÖcz, konwertuj i dopasuj skany do A4 ‚Ä¢ zmieniaj kolejno≈õƒá ‚Ä¢ podglƒÖdy miniatur i lupa.</p>
    </div>
  </div>

  <div class="card">
    <h2>1) Dodaj pliki</h2>
    <p class="sub">Obs≈Çugiwane: <span class="mono">JPG, PNG, PDF</span> (do 20 plik√≥w / 50 stron). Zmieniaj kolejno≈õƒá przeciƒÖgajƒÖc miniatury.</p>
    <div id="drop" class="drop">PrzeciƒÖgnij tutaj lub <label for="file" class="link" style="cursor:pointer">wybierz z dysku</label></div>
    <input id="file" type="file" multiple accept=".pdf,.jpg,.jpeg,.png" hidden>
    <div id="grid" class="grid"></div>
  </div>

  <div class="card">
    <h2>2) Akcje</h2>
    <div class="btns">
      <button id="toPdf" class="btn primary">üñ®Ô∏è JPG/PNG ‚Üí PDF A4 (dopasuj jak skan)</button>
      <button id="merge" class="btn">üß© Scal PDF (wg kolejno≈õci w siatce)</button>
      <button id="clear" class="btn">üßπ Wyczy≈õƒá</button>
    </div>
    <p class="sub small">Uwaga: wszystko liczy siƒô lokalnie i nie opuszcza Twojej przeglƒÖdarki.</p>
  </div>

  <div class="card">
    <h2>3) Wynik</h2>
    <div id="out"></div>
  </div>

  <p class="footer">¬© 2025 DinoFiles ‚Ä¢ Wersja demo UI. Miniatury PDF generowane przy pomocy PDF.js (CDN).</p>
</div>

<!-- pdf-lib -->
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<!-- pdf.js (for thumbnails) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js"></script>
<script>
const $ = s => document.querySelector(s);
const grid = $("#grid"), drop=$("#drop"), fileInput=$("#file"), out=$("#out");
const btnToPdf=$("#toPdf"), btnMerge=$("#merge"), btnClear=$("#clear");
let items = []; // [{file, thumbCanvas|img}]

function addFiles(list){
  const arr = Array.from(list||[]);
  const acc = arr.filter(f => /pdf|jpeg|jpg|png/i.test(f.type) || /\.pdf$/i.test(f.name));
  items = items.concat(acc.map(f=>({file:f}))).slice(0,20);
  renderGrid();
}

function human(bytes){const u=['B','KB','MB','GB'];let i=0,b=bytes;while(b>1024&&i<u.length-1){b/=1024;i++}return b.toFixed(1)+' '+u[i];}

async function renderGrid(){
  grid.innerHTML='';
  for (let i=0;i<items.length;i++){
    const it = items[i];
    const el = document.createElement('div');
    el.className='item'; el.draggable=true; el.dataset.idx=i;

    const actions = document.createElement('div');
    actions.className='actions';
    const zoomBtn = document.createElement('button'); zoomBtn.className='iconbtn'; zoomBtn.title='PodglƒÖd'; zoomBtn.textContent='üîç';
    actions.appendChild(zoomBtn);
    el.appendChild(actions);

    const t = document.createElement('div'); t.className='thumb';
    el.appendChild(t);

    const cap = document.createElement('div'); cap.className='caption';
    cap.textContent = (i+1)+'. '+it.file.name+' ‚Ä¢ '+human(it.file.size);
    el.appendChild(cap);

    // build thumb
    if (/pdf$/i.test(it.file.name)) {
      const data = await it.file.arrayBuffer();
      const loadingTask = pdfjsLib.getDocument({data});
      const pdf = await loadingTask.promise;
      const page = await pdf.getPage(1);
      const viewport = page.getViewport({scale:0.3});
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = viewport.width; canvas.height=viewport.height;
      await page.render({canvasContext:ctx, viewport}).promise;
      t.appendChild(canvas);
      it.thumb = canvas;
      zoomBtn.onclick = ()=> openModalCanvas(canvas);
    } else {
      const img = document.createElement('img');
      img.src = URL.createObjectURL(it.file);
      t.appendChild(img);
      it.thumb = img;
      zoomBtn.onclick = ()=> openModalImg(img.src);
    }

    // drag events
    el.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', i); el.classList.add('dragging'); });
    el.addEventListener('dragend', ()=> el.classList.remove('dragging'));
    el.addEventListener('dragover', e=>{ e.preventDefault(); const from = Number(e.dataTransfer.getData('text/plain')); const to = Number(el.dataset.idx); if(from===to) return; grid.insertBefore(grid.children[from], (from<to)? grid.children[to].nextSibling : grid.children[to]); });
    el.addEventListener('drop', e=>{
      e.preventDefault();
      const from = Number(e.dataTransfer.getData('text/plain'));
      const to = Number(el.dataset.idx);
      if(from===to) return;
      const moved = items.splice(from,1)[0];
      items.splice(to,0,moved);
      renderGrid();
    });

    grid.appendChild(el);
  }
}

drop.addEventListener('dragover', e=>{e.preventDefault(); drop.classList.add('drag')});
drop.addEventListener('dragleave', ()=> drop.classList.remove('drag'));
drop.addEventListener('drop', e=>{e.preventDefault(); drop.classList.remove('drag'); addFiles(e.dataTransfer.files)});
drop.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', e=> addFiles(e.target.files));
btnClear.addEventListener('click', ()=>{ items=[]; grid.innerHTML=''; out.innerHTML=''; });

// Convert images -> A4 PDF
btnToPdf.addEventListener('click', async ()=>{
  const imgs = items.map(x=>x.file).filter(f => /jpeg|jpg|png/i.test(f.type));
  if(imgs.length===0){ alert('Dodaj najpierw JPG/PNG.'); return; }
  const { PDFDocument, rgb } = PDFLib;
  const pdf = await PDFDocument.create();
  for(const f of imgs){
    const arr = await f.arrayBuffer();
    let img; if(/png/i.test(f.type)) img = await pdf.embedPng(arr); else img = await pdf.embedJpg(arr);
    const A4={w:595.28,h:841.89}; const page = pdf.addPage([A4.w,A4.h]);
    page.drawRectangle({x:0,y:0,width:A4.w,height:A4.h,color:rgb(1,1,1)});
    const margin=24, maxW=A4.w-margin*2, maxH=A4.h-margin*2;
    const s=Math.min(maxW/img.width,maxH/img.height);
    const w=img.width*s,h=img.height*s,x=(A4.w-w)/2,y=(A4.h-h)/2;
    page.drawImage(img,{x,y,width:w,height:h});
  }
  const bytes = await pdf.save();
  const url = URL.createObjectURL(new Blob([bytes],{type:'application/pdf'}));
  out.innerHTML = '<a class="link" download="DinoFiles_A4.pdf" href="'+url+'">‚¨áÔ∏è Pobierz PDF ‚ÄûDinoFiles_A4.pdf‚Äù</a>';
});

// Merge PDFs in current order
btnMerge.addEventListener('click', async ()=>{
  const pdfs = items.map(x=>x.file).filter(f => /\.pdf$/i.test(f.name));
  if(pdfs.length<2){ alert('Dodaj co najmniej 2 PDF-y.'); return; }
  const { PDFDocument } = PDFLib;
  const merged = await PDFDocument.create();
  for(const f of pdfs){
    const bytes = await f.arrayBuffer();
    const donor = await PDFDocument.load(bytes);
    const pages = await merged.copyPages(donor, donor.getPageIndices());
    pages.forEach(p => merged.addPage(p));
  }
  const outBytes = await merged.save();
  const url = URL.createObjectURL(new Blob([outBytes],{type:'application/pdf'}));
  out.innerHTML = '<a class="link" download="DinoFiles_Merged.pdf" href="'+url+'">‚¨áÔ∏è Pobierz scalony PDF ‚ÄûDinoFiles_Merged.pdf‚Äù</a>';
});

// Modal preview
const modal = document.createElement('div'); modal.className='modal'; modal.innerHTML = '<div class="modal-body"><button class="close">‚úñ</button><div id="modalContent"></div></div>'; document.body.appendChild(modal);
const modalContent = modal.querySelector('#modalContent'); const closeBtn = modal.querySelector('.close'); closeBtn.onclick = ()=> modal.classList.remove('open');
function openModalImg(src){ modalContent.innerHTML=''; const img=document.createElement('img'); img.src=src; modalContent.appendChild(img); modal.classList.add('open'); }
function openModalCanvas(c){ modalContent.innerHTML=''; const img=document.createElement('img'); img.src=c.toDataURL(); modalContent.appendChild(img); modal.classList.add('open'); }
</script>
</body>
</html>
